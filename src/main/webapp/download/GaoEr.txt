select schoolName,
			 
			 IFNULL((select sum(schoolRollNums) from hq_stu_schoolroll_info where schoolName = t.schoolName) , '') AS schoolRollNums,
			 count(IFNULL(t.schoolRollId , 0)) as realExamNums,
			 sum(IFNULL(math , 0) + IFNULL(chinese , 0) + IFNULL(english , 0) + IFNULL(physical , 0) + IFNULL(chemical , 0) + IFNULL(biological , 0) + IFNULL(geographic , 0) + IFNULL(history , 0) + IFNULL(politics , 0) + IFNULL(technology , 0)) as totalScore
from (
	select 
				 b.schoolName ,
				 b.schoolRollId,
				 count(schoolRollId) as countNums,
				 sum(case when a.subjectCode = 1 then a.subjectScore end) as math,
				 sum(case when a.subjectCode = 2 then a.subjectScore end) as chinese,
				 sum(case when a.subjectCode = 3 then a.subjectScore end) as english,
				 sum(case when es.subjectCode= 4 and i.physicalChooseIntention = 1 then es.subjectScore end) as physical,
				 sum(case when es.subjectCode= 5 and i.chemicalChooseIntention = 1 then es.subjectScore end) as chemical,
				 sum(case when es.subjectCode= 6 and i.biologicalChooseIntention = 1 then es.subjectScore end) as biological,
				 sum(case when es.subjectCode= 7 and i.geographicChooseIntention = 1 then es.subjectScore end) as geographic,
				 sum(case when es.subjectCode= 8 and i.historyChooseIntention = 1 then es.subjectScore end) as history,
				 sum(case when es.subjectCode= 20 and i.politicsChooseIntention = 1 then es.subjectScore end) as politics,
				 sum(case when es.subjectCode= 21 and i.technologyChooseIntention = 1 then es.subjectScore end) as technology
	from hq_student_base_info b  , hq_stu_avg_score_1 a , hq_stu_endow_score es , hq_stu_subject_intention i 
	where b.schoolRollId = a.recordNumsber and b.schoolRollId = es.recordNumsber and a.analyzeId=  :analyzeId
	and b.gradeId = :gradeId
	and i.studentId = b.id GROUP BY b.schoolRollId
 
) t ORDER BY totalScore desc
